<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>xLess</title>
    <link href="test/index.css" type="text/css" rel="stylesheet" />
</head>
<body>
<nav class="nav">
    <div class="github">
        <ul class="navigator-func">
            <li><a href="https://github.com/royJang/xless"><button class="forkMe">Fork me on Github</button></a></li>
            <li class="jump-animate"><a href="javascript:void(0);"><p>动画</p><p>Animate</p></a></li>
            <li class="jump-components"><a href="javascript:void(0);"><p>组件</p><p>Components</p></a></li>
            <li class="jump-download"><a href="javascript:void(0);"><p>下载</p><p>Download</p></a></li>
        </ul>
    </div>
    <div class="title"><span>x</span><span>L</span><span>e</span><span>s</span><span>s</span></div>
</nav>
<main>
    <div id="gh-animate" class="gh-animate">
        <div class="left-nav">
            <ul class="effect-list"></ul>
        </div>
        <div class="right-nav">
            <div class="compatibilityTable">
                <ul class="browser">
                    <li>Chrome</li>
                    <li>Internet Explorer</li>
                    <li>Firefox</li>
                    <li>Safari</li>
                    <li>Opera</li>
                </ul>
                <ul class="browserCompatibility">
                    <li class="chrome">/</li>
                    <li class="ie">/</li>
                    <li class="ff">/</li>
                    <li class="safari">/</li>
                    <li class="opera">/</li>
                </ul>
            </div>
            <div class="stage">
                <div class="cube cube1"></div>
                <div class="cube cube2"></div>
                <div class="cube cube3"></div>
                <div class="cube cube4"></div>
                <div class="cube cube5"></div>
            </div>
        </div>
    </div>
    <div id="gh-components" class="gh-components">
        <div class="left-nav">
            <ul class="components-list"></ul>
        </div>
        <div class="right-nav">
            <div class="stage">
                <div class="module">
                    <p>演示</p>
                    <div class="demo">

                    </div>
                </div>
                <div class="module">
                    <p>HTML</p>
                    <textarea class="html-code" contenteditable="false" readonly>

                    </textarea>
                </div>
            </div>
        </div>
    </div>
    <div id="gh-download" class="gh-download">
        <div class="download-channel">
            <div class="download-channel-animate">
                <p>Animate</p>
                <ul class="download-channel-animate-list"></ul>
            </div>
            <div class="download-channel-components">
                <p>Components</p>
                <ul class="download-channel-components-list"></ul>
            </div>
        </div>
        <div class="gh-download-func">
            <button>download (.less)</button>
            <button>download (.scss)</button>
            <button>download (.css)</button>
        </div>
    </div>
</main>
<script src="//upcdn.b0.upaiyun.com/libs/jquery/jquery-2.0.3.min.js"></script>
<script src="test/data/effectExplain.js"></script>
<script src="test/data/components.js"></script>
<script>
    (function(){
        var downloadAnimateArr = [],
            downloadComponentsArr = [],
            downloadFormat = function ( el ){
                return "<li><label><input type='checkbox'><span>" + el + "</span></label></li>";
            },
            channelFormat = function ( el ){
                return "<li effect-name="+ el +"><span>" + el + "</span></li>";
            };
        //添加animate.effect列表进入dom
        var arr = [];
        Object.keys(effect_list).forEach(function ( el ){
            arr.push(
                channelFormat(el)
            );
            downloadAnimateArr.push(
                downloadFormat(el)
            );
        });

        //添加components列表进入dom
        var componentsArr = [];
        Object.keys(component_list).forEach(function ( el ){
            componentsArr.push(
                channelFormat(el)
            );
            downloadComponentsArr.push(
                downloadFormat(el)
            );
        });

        $(".effect-list").html(arr.join(""));
        $(".components-list").html(componentsArr.join(""));
        $(".download-channel-animate-list").html(downloadAnimateArr.join(""));
        $(".download-channel-components-list").html(downloadComponentsArr.join(""));
        //页面间切换
        var navigator = $(".navigator-func"),
            ghAnimate = $(".gh-animate");

        var In = "zoomInLeft",
            Out = "zoomOutRight";

        var afterChannel = ghAnimate,
            animating = false;
        var jumpTo = function ( channel ){
            if( channel.attr("id") === afterChannel.attr("id") || animating ) return;
            animating = true;
            channel.removeClass(Out).addClass(In).show();
            afterChannel.removeClass(In).addClass(Out);
            setTimeout(function (){
                afterChannel.hide();
                afterChannel = channel;
                animating = false;
            }, 500)
        };

        navigator.find(".jump-animate, .jump-components, .jump-download").on("click", function (e){
            var v = e.currentTarget.className.replace(/jump-/,"");
            jumpTo($(".gh-"+v));
        });

    })();

    //gh-animate
    (function (){
        var cube = $(".stage").find("div.cube");
        var logo = $(".title").find("span");
        var i = 0;
        var j = 0;
        var k = 0;
        var timer = null;
        var timer2 = null;
        var max = 4;

        var fb = function (e1,e2,e3){
            if(j>max) return;
            clearTimeout(timer);
            timer = setTimeout(function (){
                if(j == max ){
                    logo.eq(j).addClass(e3);
                    logo.eq(j).show();
                    j = 0;
                }else {
                    logo.eq(j).addClass(j % 2 == 0 ? e1 : e2);
                    logo.eq(j).show();
                }
                j++;
                fb(e1,e2,e3);
            },300)
        };

        var fb2 = function (e1,e2,e3){
            if(k>max) return;
            clearTimeout(timer2);
            timer2 = setTimeout(function (){
                if(k == max ){
                    cube.eq(k).addClass(e3);
                    cube.eq(k).show();
                    k = 0;
                }else {
                    cube.eq(k).addClass(k % 2 == 0 ? e1 : e2);
                    cube.eq(k).show();
                }
                k++;
                fb2(e1,e2,e3);
            },300)
        };

        fb("zoomInLeft","zoomInRight","zoomInDown");
        fb2("","","");

        var bc = $(".browserCompatibility");
        var chrome = bc.find(".chrome"),
                ie = bc.find(".ie"),
                ff = bc.find(".ff"),
                safari = bc.find(".safari"),
                opera = bc.find(".opera");

        $(".effect-list").find("li").on("click", function (){
            var val = $(this).attr("effect-name");
            if( i > max) i = 0;
            cube.eq(i).attr("class","cube cube"+ (i+1));
            cube.eq(i).addClass(val);
            var cbl = effect_list[val].compatibility;

            if( cbl ){
                ie.html( cbl.ie || "10+" );
                chrome.html( cbl.chrome || "ok" );
                ff.html( cbl.ff || "ok" );
                safari.html( cbl.safari || "ok" );
                opera.html( cbl.opera || "ok" );
            }else{
                bc.find("li").html("ok");
                bc.find("li.ie").html("10+");
            }

            i++;
        });
    })();

    //gh-components
    (function (){

        var ghComponents = $(".gh-components .right-nav .stage");
        var demo = ghComponents.find(".demo");
        var htmlCode = ghComponents.find(".html-code");

        var format = function ( template ){
            var e = template.match(/<(\/?)\w+.+?(?:>)/g),
                len = e.length;

            var str = "";
            var tag = "";
            e.forEach(function (el,i){
                str += el + "\n";
            });

            return str;
        };

        var componentsList = $(".components-list").find("li");

        componentsList.on("click", function (){

            componentsList.find("span").removeClass("active");
            $(this).find("span").addClass("active");

            var r = $(this).attr("effect-name");
            var $r = component_list[r];

            $.get('src/components/' + r + '/' + r + '.html', function (data){
               var s = data.indexOf("<template>"),
                   e = data.indexOf("</template>");
               var $data = data.slice(s+10,e).replace(/^\s+?|\s+?$/g,"");
                demo.html($data);
                htmlCode.css("height", 25 * $r.line + 20);
                htmlCode.html($data);
            });
        });

        componentsList.eq(0).trigger("click");
    })();

    //gh-download
    (function (){



    })();

</script>
</body>
</html>